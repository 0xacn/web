<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Deck - memorize.ai</title>
	<script defer src="/__/firebase/5.8.4/firebase-app.js"></script>
	<script defer src="/__/firebase/5.8.4/firebase-auth.js"></script>
	<script defer src="/__/firebase/5.8.4/firebase-firestore.js"></script>
	<script defer src="/__/firebase/5.8.4/firebase-messaging.js"></script>
	<script defer src="/__/firebase/5.8.4/firebase-storage.js"></script>
	<script defer src="/__/firebase/init.js"></script>
    <script src="elm/Deck.js"></script>
	<script src="js/elm.js"></script>
	<link href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.4/css/bulma.min.css" rel="stylesheet">
	<link href="css/main.css" rel="stylesheet">
	<link href="https://cdn.jsdelivr.net/npm/instantsearch.css@7.1.0/themes/algolia.css" rel="stylesheet">
	<link href="css/search.css" rel="stylesheet">
	<script>
	const deckId = new URLSearchParams(window.location.search).get('id') || 'abc'
	const fbListenDeck = app =>
		firebase.firestore().collection('decks').doc(deckId)
			.onSnapshot(doc =>
				app.ports.updateDeck.send(Object.assign({photoUrl: null}, doc.data()))
			)

	const userFromFirebase = fbUser =>
		({ name: fbUser.displayName || 'Temporarily Unknown'
		 , uid: fbUser.uid
		 })

	const updateUser = app => user =>
		user && app.ports.updateUser.send(userFromFirebase(user))

	document.addEventListener('DOMContentLoaded', function() {
		const app = Elm.Page.Deck.init({flags: deckId})
		firebase.auth().onAuthStateChanged(updateUser(app))
		listenSignOut(app)
		fbListenDeck(app)
		setTimeout(startSearch, 100)
	})
	</script>
	<script src="js/main.js"></script>
	<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
	<script type="text/html" id="hit-template">
		<div class="hit">
			<a href="deck?id={{ objectID }}"><h6 class="title is-6">{{#helpers.highlight}}{ "attribute": "name" }{{/helpers.highlight}}</h6>
			{{#helpers.highlight}}{ "attribute": "description" }{{/helpers.highlight}}</a>
		</div>
	</script>
	<script src="https://cdn.jsdelivr.net/npm/instantsearch.js@3.0.0"></script>
	<script src="js/search.js"></script>
</head>
<body>
</body>
</html>